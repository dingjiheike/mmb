<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>首页》全部分类》电视</title>
    <script type="text/javascript">
        var fontSize = window.screen.width / 20;
        document.querySelector('html').style.fontSize = fontSize + "px";
        window.onresize = function () {
            var fontSize = window.screen.width / 20;
            document.querySelector('html').style.fontSize = fontSize + "px";
        }
    </script>
    <link rel="stylesheet" type="text/css" href="css/index_mayunfei.css">
    <link rel="stylesheet" href="css/categories-tv.css">
</head>

<body>
    <!--头部区域模板-->
    <header id="header" class="header">


        <div class="logo">
            <a href="./index.html" title="慢慢买">
                <img src="images/header_logo.png" alt="">
            </a>
        </div>
        <div class="appDown">
            <a href="javascript:void(0)" title="手机app下载">
                <img src="images/header_app.png" alt="手机app下载"></a>
        </div>
    </header>
    <!--搜索框-->
    <section id="form-search">
        <form action="#" class="search">
            <input type="search" name="" value="" placeholder="请输入你想比价的商品">
            <input type="button" value="搜索">
        </form>
    </section>
    <!--*******导航开始******-->
    <div class="nav">
        <div class="nav_left fl">
            <a href="./index.html">首页</a> >
            <a href="category.html">全部分类</a> >
            <!--<a href="#">电视</a>-->
            <!--添加模板-->
        </div>
        <div class="nav_right fr"><button>筛选</button></div>
    </div>
    <!--*******导航结束******-->
    <!--*******内容开始******-->
    <ul class="content">
        <!--<li>
            <div class="con_left fl">
                <img src="images/ic_temai.png" alt=""> </div>
            <div class="con_right fr">
                <a href="#">乐视TV(Letv)S50 Air全配版2D 50英寸 全高清LED液晶电视</a>
                <p>￥1990.00</p>
                <span>报价(6)</span>
                <span>评论(2286)</span>

            </div>
        </li>
        <li>
            <div class="con_left">
                <img src="images/ic_temai.png" alt=""> </div>
            <div class="con_right">
                <a href="#">乐视TV(Letv)S50 Air全配版2D 50英寸 全高清LED液晶电视</a>
                <p>￥1990.00</p>
                <span>报价(6)</span>
                <span>评论(2286)</span>

            </div>
        </li>
        <li>
            <div class="con_left">
                <img src="images/ic_temai.png" alt=""> </div>
            <div class="con_right">
                <a href="#">乐视TV(Letv)S50 Air全配版2D 50英寸 全高清LED液晶电视</a>
                <p>￥1990.00</p>
                <span>报价(6)</span>
                <span>评论(2286)</span>

            </div>
        </li>
        <li>
            <div class="con_left">
                <img src="images/ic_temai.png" alt=""> </div>
            <div class="con_right">
                <a href="#">乐视TV(Letv)S50 Air全配版2D 50英寸 全高清LED液晶电视</a>
                <p>￥1990.00</p>
                <span>报价(6)</span>
                <span>评论(2286)</span>

            </div>
        </li>
        <li>
            <div class="con_left">
                <img src="images/ic_temai.png" alt=""></div>
            <div class="con_right">
                <a href="#">乐视TV(Letv)S50 Air全配版2D 50英寸 全高清LED液晶电视</a>
                <p>￥1990.00</p>
                <span>报价(6)</span>
                <span>评论(2286)</span>

            </div>
        </li>
        <li>
            <div class="con_left">
                <img src="images/ic_temai.png" alt=""></div>
            <div class="con_right">
                <a href="#">乐视TV(Letv)S50 Air全配版2D 50英寸 全高清LED液晶电视</a>
                <p>￥1990.00</p>
                <span>报价(6)</span>
                <span>评论(2286)</span>

            </div>
        </li>
        <li>
            <div class="con_left">
                <img src="images/ic_temai.png" alt=""> </div>
            <div class="con_right">
                <a href="#">乐视TV(Letv)S50 Air全配版2D 50英寸 全高清LED液晶电视</a>
                <p>￥1990.00</p>
                <span>报价(6)</span>
                <span>评论(2286)</span>

            </div>
        </li>
        <li>
            <div class="con_left">
                <img src="images/ic_temai.png" alt=""> </div>
            <div class="con_right">
                <a href="#">乐视TV(Letv)S50 Air全配版2D 50英寸 全高清LED液晶电视</a>
                <p>￥1990.00</p>
                <span>报价(6)</span>
                <span>评论(2286)</span>

            </div>
        </li>
        <li>
            <div class="con_left">
                <img src="images/ic_temai.png" alt=""></div>
            <div class="con_right">
                <a href="#">乐视TV(Letv)S50 Air全配版2D 50英寸 全高清LED液晶电视</a>
                <p>￥1990.00</p>
                <span>报价(6)</span>
                <span>评论(2286)</span>
            </div>

        </li>
        <li>
            <div class="con_left">
                <img src="images/ic_temai.png" alt="">
            </div>
            <div class="con_right">
                <a href="#">乐视TV(Letv)S50 Air全配版2D 50英寸 全高清LED液晶电视</a>
                <p>￥1990.00</p>
                <span>报价(6)</span>
                <span>评论(2286)</span>
            </div>
        </li>-->
    </ul>
    <!--*******导航结束******-->
    <!--*******页码开始******-->
    <div class="page" id="page">
        <button class="btn_left fl">上一页</button>
        <select name="" id="select" class='fl'>
            <!--<option value="" selected='selected'>1/3</option>
            <option value="">2/3</option>
            <option value="">3/3</option>-->
        </select>
        <button class="btn_right fr">下一页</button>
    </div>
    <!--*******页码结束******-->
    <footer id="foot">
        <div class="foot_top">
            <a href="javascript:void(0)">登录</a>
            <a href="javascript:void(0)">注册</a>
            <a href="#" style="width: 40%; border: 0;">
                <img src="images/top.jpg" width="15" height="15">返回顶部</a>
        </div>
        <div class="footer">
            <p>
                <a href="javascript:void(0)" style="color: Red;">手机APP下载</a> <a href="index.html">
                    慢慢买手机版</a> -- 掌上比价平台
            </p>
            <p>
                m.manmanbuy.com
                <img src="" width="0" height="0">
            </p>
        </div>
    </footer>
</body>
<!--*******模板区域******-->
<!--导航-->
<script type="text/template" id="template">
    {{each result}}
    <a href="#">{{$value.category}}</a> {{/each}}
</script>
<!--内容-->
<!--当反回的数据为标签样式时，在$前面加个#{{#$value.productImg}}-->
<!--这里的a标签还需要发送本页的数据给子页面作为数据-->
<script type="text/template" id="template2">
    {{each result}}
    <li data-brandName="'{{$value.productImg}}" data-brandId="'{{$value.brandId}}'">
        <div class="con_left">
            {{#$value.productImg}}
        </div>
        <div data-brandTitleId='{{$value.brandTitleId}}' class="con_right">
            <a href="productinfo.html?categoryid=~{{$value.categoryId}}~&productId=~{{$value.productId}}~&pageid=~1~&productName=~{{$value.productName}}~&productImg=~{{$value.productImg}}~&bjShop=~{{$value.bjShop}}~&categoryId=~{{$value.categoryId}}~">{{$value.productName}}</a>
            <p>{{$value.productPrice}}</p>
            <span>{{$value.productQuote}}</span>
            <span>{{$value.productCom}}</span>
        </div>
    </li>
    {{/each}}
</script>
<script type="text/template" id="template3">
    {{each }}
    <option value="" selected='selected'>1/3</option>
    {{/each}}
</script>

<!--*******模板区域结束******-->

</html>
<script type="text/javascript" src="lib/zepto/zepto.js"></script>
<script type="text/javascript" src="lib/zepto/event.js"></script>
<script type="text/javascript" src="lib/zepto/fx.js"></script>
<script type="text/javascript" src="lib/zepto/touch.js"></script>
<script type="text/javascript" src="lib/zepto/ajax.js"></script>
<!--<script type="text/javascript" src="js/index.js"></script>-->
<script type="text/javascript" src="js/template.js"></script>

<script>
    $(function () {
        // 这里需要现获取从url过来的数据作为ajax需要发送的数据
        var url = window.location.href;
        // 获取地址栏的数据
        // console.log(url);
        // 拆掉地址栏的数据
        var arr = url.split('~');
        // console.log(arr);
        var categoryid = parseInt(arr[1]);
        // console.log(categoryid);
        var category = arr[3];
        var pageid = arr[5];
        $.ajax({
            url: "http://139.199.192.48:9090/api/getcategorybyid?categoryid=" + categoryid,
            success: function (data) {
                // console.log(data);
                var content = template('template', data);
                //   console.log(content);
                $('.nav_left ').append(content);
            }
        })
        $.ajax({
            url: "http://139.199.192.48:9090/api/getproductlist",
            data: {
                "categoryid": categoryid,
                "pageid": pageid
            },
            success: function (data) {
                console.log(data);
                console.log(data.totalCount);
                var content = template('template2', data);
                $('.content ').append(content);
                // 动态添加页码
                var tiaoshu = Math.ceil(data.totalCount / 10);
                for (var i = 0; i < tiaoshu; i++) {
                    $('#select').append('<option value="' + (1 + i) + '" >' + (1 + i) + '/' +
                        tiaoshu + '</option>')
                }
                $('option').removeAttr('selected');
                $('option').eq(pageid - 1).attr('selected', 'selected');
            }
        })
        //  用change()方法设置下拉框修改效果
        $('select').change(function () {
            pageid = document.querySelector('select').value;
            $('select').html('');
            $('.content').html('');
            $.ajax({
                url: "http://139.199.192.48:9090/api/getproductlist",
                data: {
                    "categoryid": categoryid,
                    "pageid": pageid
                },
                success: function (data) {
                    console.log(data.totalCount);
                    var content = template('template2', data);
                    $('.content ').append(content);
                    // 动态添加页码
                    var tiaoshu = Math.ceil(data.totalCount / 10);
                    for (var i = 0; i < tiaoshu; i++) {
                        $('#select').append('<option value="' + (1 + i) + '" >' + (1 + i) +
                            '/' + tiaoshu + '</option>')
                    }
                    $('option').removeAttr('selected');
                    $('option').eq(pageid - 1).attr('selected', 'selected');
                }
            })
        })
        // 设置底部上下一页点击效果
        $('.btn_right').click(function () {
            pageid++; //修改页面id
            // 修改select
            $('#select').children('select[selected="selected"]').css('fontSize', '50px');
            $('#select').children('select[selected="selected"]').removeAttr('selected');
            $.ajax({
                url: "http://139.199.192.48:9090/api/getproductlist",
                data: {
                    "categoryid": categoryid,
                    "pageid": pageid
                },
                success: function (data) {
                    // console.log(data);
                    console.log(data.result.length == 0);
                    // 判断下一页的数据是否为空
                    if (data.result.length == 0) {
                        pageid--; //防止点不动多点了id还在加
                        return;
                    }
                    var content = template('template2', data);
                    // console.log(content);
                    $('.content').html(content);
                    $('option').removeAttr('selected');
                    $('option').eq(pageid - 1).attr('selected', 'selected');
                }
            })
        })
        $('.btn_left').click(function () {
            // console.log('有反应吗0');
            // 修改select
            pageid--;
            if (pageid <= 0) {
                pageid++; //防止点不动多点了id还在减
                return;
            }
            console.log(pageid);
            $.ajax({
                url: "http://139.199.192.48:9090/api/getproductlist",
                data: {
                    "categoryid": categoryid,
                    "pageid": pageid
                },
                success: function (data) {
                    console.log('有反应吗');
                    console.log(data);
                    console.log(data.result.length == 0);
                    // 判断下一页的数据是否为空
                    // console.log(data.result.length == 0);
                    // if (data.result.length == 0) {
                    //     pageid++; //防止点不动多点了id还在减
                    //     return;
                    // }
                    var content = template('template2', data);
                    // console.log(content);
                    $('.content').html(content);
                    $('option').removeAttr('selected');
                    $('option').attr();
                    $('option').eq(pageid - 1).attr('selected', 'selected');
                }
            })
        })
    })
</script>